modded class DayZGame
{
	static const string P3D_DIRECTORIES[473] = {"data","rocks","rocks_bliss","animals\\bos_taurus","animals\\bos_taurus_fem","animals\\canis_lupus","animals\\capra_hircus","animals\\capra_hircus_fem","animals\\capreolus_capreolus","animals\\capreolus_capreolus_fem","animals\\cervus_elaphus","animals\\cervus_elaphus_fem","animals\\gallus_gallus_domesticus","animals\\gallus_gallus_domesticus_feminam","animals\\ovis_aries","animals\\ovis_aries_fem","animals\\sus_domesticus","animals\\sus_scrofa","animals_bliss\\ursus_arctos","characters\\backpacks","characters\\belts","characters\\bodies","characters\\glasses","characters\\gloves","characters\\headgear","characters\\heads","characters\\masks","characters\\pants","characters\\proxies","characters\\shoes","characters\\tops","characters\\vests","characters\\zombies","data\\data","data\\proxies","gear\\books","gear\\camping","gear\\consumables","gear\\containers","gear\\cooking","gear\\crafting","gear\\cultivation","gear\\drinks","gear\\food","gear\\medical","gear\\navigation","gear\\optics","gear\\radio","gear\\tools","gear\\traps","plants\\bush","plants\\clutter","plants\\tree","plants_bliss\\building","plants_bliss\\Bush","plants_bliss\\Clutter","plants_bliss\\Tree","structures\\ruins","structures\\walls","structures_bliss\\ruins","structures_bliss\\walls","vehicles\\parts","water\\ponds","water\\Streambed","water\\Streams","water_bliss\\ponds","water_bliss\\river","weapons\\ammunition","weapons\\explosives","weapons\\projectiles","weapons\\proxies","animals\\Data\\Geom","characters\\belts\\proxies","characters\\headgear\\proxies","characters\\heads\\anim","characters\\masks\\proxy","characters\\vests\\proxy","data\\data\\Destruct","data\\data\\penetration","gear\\camping\\proxies","gear\\cooking\\proxy","gear\\traps\\proxy","plants\\tree\\cutted_cut","plants\\tree\\cutted_stump","structures\\furniture\\Bathroom","structures\\furniture\\Beds","structures\\furniture\\Cases","structures\\furniture\\folding_beds","structures\\furniture\\generalstore","structures\\furniture\\Hospital_transport_bed","structures\\furniture\\Prison","structures\\furniture\\radar_equipment","structures\\furniture\\School_equipment","structures\\furniture\\Various","structures\\industrial\\CementWorks","structures\\industrial\\CoalPlant","structures\\industrial\\Construction","structures\\industrial\\Containers","structures\\industrial\\Dams","structures\\industrial\\Farms","structures\\industrial\\Garages","structures\\industrial\\Harbour","structures\\industrial\\Houses","structures\\industrial\\Mines","structures\\industrial\\Misc","structures\\industrial\\Pipes","structures\\industrial\\Power","structures\\industrial\\Quarry","structures\\industrial\\Sawmills","structures\\industrial\\Sheds","structures\\industrial\\Smokestacks","structures\\industrial\\Tanks","structures\\military\\airfield","structures\\military\\houses","structures\\military\\improvised","structures\\military\\Misc","structures\\military\\tisy","structures\\Proxy_BuildingParts\\AirCondition","structures\\Proxy_BuildingParts\\Barricading","structures\\Proxy_BuildingParts\\GasMeterExt","structures\\Proxy_BuildingParts\\House","structures\\Proxy_BuildingParts\\ladders","structures\\rail\\Bridges","structures\\rail\\Houses","structures\\rail\\Misc","structures\\rail\\Tracks","structures\\residential\\Bus","structures\\residential\\firedep","structures\\residential\\HouseBlocks","structures\\residential\\houses","structures\\residential\\medical","structures\\residential\\misc","structures\\residential\\Offices","structures\\residential\\Platforms","structures\\residential\\Police","structures\\residential\\Schools","structures\\residential\\sheds","structures\\residential\\stores","structures\\residential\\Tenements","structures\\roads\\Bridges","structures\\roads\\Decals","structures\\roads\\Panels","structures\\roads\\Parts","structures\\roads\\Sidewalks","structures\\roads\\Tunnels","structures\\signs\\billboards","structures\\signs\\Directional","structures\\signs\\Misc","structures\\signs\\Settlements","structures\\signs\\tourist","structures\\signs\\Traffic","structures\\specific\\Airfields","structures\\specific\\cableway","structures\\specific\\Camps","structures\\specific\\Castles","structures\\specific\\Cemeteries","structures\\specific\\churches","structures\\specific\\DeadBodies","structures\\specific\\FuelStation","structures\\specific\\Hotel","structures\\specific\\Lunapark","structures\\specific\\prison","structures\\specific\\Radio","structures\\specific\\Skilift","structures\\specific\\Statues","structures\\specific\\towers","structures\\wrecks\\Aircraft","structures\\wrecks\\ships","structures\\wrecks\\Trains","structures\\wrecks\\Vehicles","structures_bliss\\industrial\\Construction","structures_bliss\\industrial\\DieselPowerPlant","structures_bliss\\industrial\\Farms","structures_bliss\\industrial\\Garages","structures_bliss\\industrial\\Harbour","structures_bliss\\industrial\\Houses","structures_bliss\\industrial\\Misc","structures_bliss\\industrial\\Pipes","structures_bliss\\industrial\\Power","structures_bliss\\industrial\\Sheds","structures_bliss\\industrial\\Smokestacks","structures_bliss\\industrial\\WindPowerPlant","structures_bliss\\military\\Bunkers","structures_bliss\\military\\houses","structures_bliss\\military\\Misc","structures_bliss\\military\\training","structures_bliss\\rail\\Misc","structures_bliss\\rail\\Tracks","structures_bliss\\residential\\Bus","structures_bliss\\residential\\Houses","structures_bliss\\residential\\Medical","structures_bliss\\residential\\misc","structures_bliss\\residential\\Police","structures_bliss\\residential\\Slums","structures_bliss\\residential\\Stores","structures_bliss\\roads\\Bridges","structures_bliss\\roads\\Decals","structures_bliss\\roads\\Misc","structures_bliss\\roads\\Panels","structures_bliss\\roads\\Parts","structures_bliss\\roads\\Sidewalks","structures_bliss\\roads\\Sinkhole","structures_bliss\\ruins\\proxy","structures_bliss\\signs\\Directional","structures_bliss\\signs\\Misc","structures_bliss\\signs\\Settlements","structures_bliss\\signs\\tourist","structures_bliss\\specific\\Airfields","structures_bliss\\specific\\Castles","structures_bliss\\specific\\cultural","structures_bliss\\specific\\forest","structures_bliss\\specific\\FuelStation","structures_bliss\\specific\\Towers","structures_bliss\\specific\\Tribune","structures_bliss\\underground\\Corridor","structures_bliss\\underground\\entrance","structures_bliss\\underground\\Floor","structures_bliss\\underground\\Stairs","structures_bliss\\underground\\storage","structures_bliss\\underground\\Terrain","structures_bliss\\underground\\Tunnel","structures_bliss\\underground\\Water","structures_bliss\\wrecks\\Ships","structures_bliss\\wrecks\\Vehicles","surfaces\\data\\roadway","vehicles\\wheeled\\civiliansedan","vehicles\\wheeled\\hatchback_02","vehicles\\wheeled\\offroadhatchback","vehicles\\wheeled\\offroad_02","vehicles\\wheeled\\proxies","vehicles\\wheeled\\sedan_02","vehicles\\wheeled\\transitbus","vehicles\\wheeled\\truck_01","vehicles\\wheeled\\truck_02","vehicles\\wheeled\\van_01","water\\ponds\\moss","water\\Streambed\\misc","water\\Streambed\\Proxy","weapons\\archery\\bow_pvc","weapons\\archery\\bow_quickie","weapons\\archery\\bow_recurve","weapons\\archery\\crossbow","weapons\\attachments\\light","weapons\\attachments\\magazine","weapons\\attachments\\muzzle","weapons\\attachments\\optics","weapons\\attachments\\support","weapons\\attachments\\underslung","weapons\\firearms\\ak101","weapons\\firearms\\ak74","weapons\\firearms\\AKM","weapons\\firearms\\aug","weapons\\firearms\\B95","weapons\\firearms\\cz527","weapons\\firearms\\cz550","weapons\\firearms\\cz61","weapons\\firearms\\fal","weapons\\firearms\\famas","weapons\\firearms\\Izh18","weapons\\firearms\\M14","weapons\\firearms\\m16a2","weapons\\firearms\\m249","weapons\\firearms\\M4","weapons\\firearms\\mini_uzi","weapons\\firearms\\mosin9130","weapons\\firearms\\MP5","weapons\\firearms\\ots14","weapons\\firearms\\pkm","weapons\\firearms\\pm73rak","weapons\\firearms\\pp19","weapons\\firearms\\repeater","weapons\\firearms\\Ruger1022","weapons\\firearms\\scout","weapons\\firearms\\SKS","weapons\\firearms\\speargun","weapons\\firearms\\ssg82","weapons\\firearms\\svd","weapons\\firearms\\Trumpet","weapons\\firearms\\UMP45","weapons\\firearms\\vss","weapons\\firearms\\winchester70","weapons\\launchers\\gp25","weapons\\launchers\\law","weapons\\launchers\\m203","weapons\\launchers\\m79","weapons\\launchers\\rpg7","weapons\\melee\\blade","weapons\\melee\\blunt","weapons\\melee\\powered","weapons\\nonlethal\\dartgun","weapons\\nonlethal\\shockpistol","weapons\\pistols\\1911","weapons\\pistols\\CZ75","weapons\\pistols\\de","weapons\\pistols\\derringer","weapons\\pistols\\flaregun","weapons\\pistols\\fnx45","weapons\\pistols\\glock","weapons\\pistols\\LongHorn","weapons\\pistols\\magnum","weapons\\pistols\\mkii","weapons\\pistols\\p1","weapons\\pistols\\pb6p9","weapons\\pistols\\pmm","weapons\\pistols\\Red9","weapons\\shotguns\\Izh18Shotgun","weapons\\shotguns\\Izh43","weapons\\shotguns\\Mp133","weapons\\shotguns\\Remington_r12","weapons\\shotguns\\saiga","data\\data\\ParticleEffects\\CraterLong","data\\data\\ParticleEffects\\Excretion","data\\data\\ParticleEffects\\Hit_Leaves","data\\data\\ParticleEffects\\News","data\\data\\ParticleEffects\\Pstone","data\\data\\ParticleEffects\\Shard","data\\data\\ParticleEffects\\Universal","data\\data\\ParticleEffects\\WallPart","structures\\furniture\\Bathroom\\Basin_A","structures\\furniture\\Bathroom\\bath","structures\\furniture\\Bathroom\\SINK","structures\\furniture\\Bathroom\\toilet_b_02","structures\\furniture\\Cases\\almara","structures\\furniture\\Cases\\case_a","structures\\furniture\\Cases\\case_bedroom_a","structures\\furniture\\Cases\\case_bedroom_b","structures\\furniture\\Cases\\case_cans_b","structures\\furniture\\Cases\\case_d","structures\\furniture\\Cases\\Dhangar_borwnskrin","structures\\furniture\\Cases\\Dhangar_borwnskrin_old","structures\\furniture\\Cases\\library_a","structures\\furniture\\Cases\\lobby_case","structures\\furniture\\Cases\\locker","structures\\furniture\\Cases\\metalcase","structures\\furniture\\Cases\\metalcrate","structures\\furniture\\Cases\\metalcrate_02","structures\\furniture\\Cases\\sarcophagus","structures\\furniture\\Cases\\Skrin_bar","structures\\furniture\\Chairs\\Church_chair","structures\\furniture\\Chairs\\ch_mod_c","structures\\furniture\\Chairs\\ch_mod_h","structures\\furniture\\Chairs\\ch_office_B","structures\\furniture\\Chairs\\hospital_bench","structures\\furniture\\Chairs\\kitchen_chair_a","structures\\furniture\\Chairs\\lobby_chair","structures\\furniture\\Chairs\\office_chair","structures\\furniture\\Chairs\\postel_manz_kov","structures\\furniture\\Chairs\\postel_panelak1","structures\\furniture\\Chairs\\SofaCorner","structures\\furniture\\Chairs\\Sofa_leather","structures\\furniture\\Chairs\\vojenska_palanda","structures\\furniture\\decoration\\box_c","structures\\furniture\\decoration\\bucket","structures\\furniture\\decoration\\carpet_big","structures\\furniture\\decoration\\Flowers","structures\\furniture\\decoration\\lekarnicka","structures\\furniture\\decoration\\piano","structures\\furniture\\Eletrical_appliances\\pc","structures\\furniture\\Eletrical_appliances\\phonebox","structures\\furniture\\Eletrical_appliances\\pokladna","structures\\furniture\\Eletrical_appliances\\radio_b","structures\\furniture\\Eletrical_appliances\\tv_a","structures\\furniture\\Eletrical_appliances\\vending_machine","structures\\furniture\\Eletrical_appliances\\washing_machine","structures\\furniture\\kitchen\\case_sink_a","structures\\furniture\\kitchen\\dkamna_uhli","structures\\furniture\\kitchen\\Fireplace_grill","structures\\furniture\\kitchen\\fridge","structures\\furniture\\kitchen\\KitchenDesk","structures\\furniture\\kitchen\\Kitchenstove_Elec","structures\\furniture\\Lighting\\fluor_lamp","structures\\furniture\\Lighting\\hangar_lamp","structures\\furniture\\Lighting\\Light_BathRoom","structures\\furniture\\Lighting\\light_kitchen_03","structures\\furniture\\Lighting\\luxury_lamp","structures\\furniture\\Lighting\\Luxury_light","structures\\furniture\\medical\\medical_table","structures\\furniture\\medical\\patient_monitor","structures\\furniture\\Tables\\conference_table_a","structures\\furniture\\Tables\\kitchen_table_a","structures\\furniture\\Tables\\lobby_counter","structures\\furniture\\Tables\\lobby_table","structures\\furniture\\Tables\\office_desk","structures\\furniture\\Tables\\office_table_a","structures\\furniture\\Tables\\stul_kuch1","structures\\furniture\\Tables\\table_drawer","structures\\furniture\\Tables\\table_umakart","structures\\industrial\\CementWorks\\Proxy","structures\\industrial\\CoalPlant\\Proxy","structures\\industrial\\Construction\\Proxy","structures\\industrial\\Farms\\Proxy","structures\\industrial\\Houses\\Proxy","structures\\industrial\\Mines\\Proxy","structures\\industrial\\Misc\\Proxy","structures\\industrial\\Sawmills\\Proxy","structures\\industrial\\Sheds\\Proxy","structures\\military\\airfield\\Proxy","structures\\military\\houses\\Proxy","structures\\military\\improvised\\Proxy","structures\\military\\tisy\\Proxy","structures\\Proxy_BuildingParts\\LightningCond\\LightningConductorBottom","structures\\Proxy_BuildingParts\\LightningCond\\LightningConductorConnection","structures\\Proxy_BuildingParts\\LightningCond\\LightningConductorCorner","structures\\Proxy_BuildingParts\\LightningCond\\LightningConductorMiddle","structures\\Proxy_BuildingParts\\LightningCond\\LightningConductorTop","structures\\Proxy_BuildingParts\\Roof\\AirCondition","structures\\Proxy_BuildingParts\\Roof\\AntennaBigRoof","structures\\Proxy_BuildingParts\\Roof\\AntennaSmallRoof","structures\\residential\\firedep\\Proxy","structures\\residential\\houses\\Proxy","structures\\residential\\medical\\Proxy","structures\\residential\\Offices\\Proxy","structures\\residential\\Schools\\Proxy","structures\\residential\\Tenements\\Proxy","structures\\roads\\Panels\\Proxy","structures\\specific\\Airfields\\Proxy","structures\\specific\\churches\\Proxy","structures\\specific\\Hotel\\Proxy","structures\\specific\\Lunapark\\Proxy","structures\\specific\\prison\\Proxy","structures\\specific\\Radio\\Proxy","structures\\specific\\Statues\\Proxy","structures\\wrecks\\ships\\Proxy","structures\\wrecks\\Vehicles\\Proxy","structures_bliss\\industrial\\DieselPowerPlant\\Proxy","structures_bliss\\industrial\\Power\\Proxy","structures_bliss\\military\\houses\\Proxy","structures_bliss\\residential\\Houses\\Proxy","structures_bliss\\specific\\Castles\\Proxy","structures_bliss\\specific\\cultural\\Proxy","structures_bliss\\specific\\Towers\\Proxy","structures_bliss\\underground\\Corridor\\Proxy","structures_bliss\\underground\\entrance\\proxy","structures_bliss\\underground\\Floor\\Proxy","structures_bliss\\underground\\storage\\proxy","structures_bliss\\underground\\Water\\Proxy","structures_bliss\\wrecks\\Vehicles\\proxies","vehicles\\wheeled\\civiliansedan\\proxy","vehicles\\wheeled\\civiliansedan\\wreck","vehicles\\wheeled\\data\\damagewheel","vehicles\\wheeled\\hatchback_02\\Proxy","vehicles\\wheeled\\offroadhatchback\\proxy","vehicles\\wheeled\\offroad_02\\proxy","vehicles\\wheeled\\sedan_02\\proxy","vehicles\\wheeled\\transitbus\\proxy","vehicles\\wheeled\\transitbus\\proxy_big","vehicles\\wheeled\\truck_01\\proxy","vehicles\\wheeled\\truck_02\\proxy","vehicles\\wheeled\\van_01\\proxy","weapons\\firearms\\aug\\proxy","weapons\\firearms\\ssg82\\proxy","weapons\\launchers\\m79\\proxy","weapons\\pistols\\magnum\\proxy","structures\\furniture\\decoration\\WallBoards\\picture_a","structures\\furniture\\decoration\\WallBoards\\picture_a_02","structures\\furniture\\decoration\\WallBoards\\picture_a_03","structures\\furniture\\decoration\\WallBoards\\picture_a_04","structures\\furniture\\decoration\\WallBoards\\picture_a_05","structures\\furniture\\decoration\\WallBoards\\picture_b","structures\\furniture\\decoration\\WallBoards\\picture_b_02","structures\\furniture\\decoration\\WallBoards\\picture_c","structures\\furniture\\decoration\\WallBoards\\picture_c_02","structures\\furniture\\decoration\\WallBoards\\picture_d","structures\\furniture\\decoration\\WallBoards\\picture_d_02","structures\\furniture\\decoration\\WallBoards\\picture_e","structures\\furniture\\decoration\\WallBoards\\picture_e_02","structures\\furniture\\decoration\\WallBoards\\picture_f","structures\\furniture\\decoration\\WallBoards\\picture_f_02","structures\\furniture\\decoration\\WallBoards\\picture_g","structures\\furniture\\decoration\\WallBoards\\picture_g_02","structures\\furniture\\decoration\\WallBoards\\wall_board","structures\\furniture\\decoration\\WallBoards\\wall_board_02","structures\\furniture\\decoration\\WallBoards\\wall_board_03"};
	
	// Handled in DayZGame
	static const int RPC_REQUEST_SYNC = 54364;
	static const int RPC_NODE_SYNC = 54365;
			
	void DayZGame()
	{
		SetMainMenuWorld("ChernarusPlus");
	}
	
	EditorNode GetEditor()
	{
#ifdef WORKBENCH
		return TreeNode.ROOT;
#endif		
#ifdef SERVER
		return TreeNode.ROOT;
#else		
		return EditorNode.Cast(TreeNode.ROOT.Children[GetUserManager().GetTitleInitiator().GetUid()]);
#endif
	}
			
	override bool OnInitialize()
	{
		// this will never happen, maybe requestexit -1 
		if (GetLoadState() != DayZLoadState.UNDEFINED) {
			return false;
		}

		BiosUserManager manager = GetGame().GetUserManager();
		if (manager && manager.GetTitleInitiator()) {
			manager.SelectUserEx(manager.GetTitleInitiator());
		}
		
		if (manager && manager.GetSelectedUser()) {
			SetPlayerName(manager.GetSelectedUser().GetName());
		}
				
		ParticleList.PreloadParticles();
		RegisterProfilesOptions();

		InitNotifications();
		m_Visited = {};
		GetProfileStringList("SB_Visited", m_Visited);
		
		StartRandomCutscene(GetMainMenuWorld());
				
		string address, port, password;
		if (GetCLIParam("connect", address)) {			
			GetCLIParam("port", port);	
			GetCLIParam("password", password);
								
			SetGameState(DayZGameState.CONNECTING);
			SetLoadState(DayZLoadState.CONNECT_START);
		
			if (Connect(null, address, port.ToInt(), password)) {
	            DisconnectSessionScript();
			} else {
				AddVisitedServer(address, port.ToInt());
			}
			
			return true;
		}
		
		string mission;
		if (GetCLIParam("mission", mission)) {			
			SetGameState(DayZGameState.IN_GAME);
			SetLoadState(DayZLoadState.MISSION_START);	
			PlayMission(mission);
			return true;
		}
		
		string party;
		if (GetCLIParam("party", party)) {
			if (manager) {
				manager.ParsePartyAsync(party);
			}
			
			return true;
		}
		
		return true;
	}
	
	override void OnRPC(PlayerIdentity sender, Object target, int rpc_type, ParamsReadContext ctx)
	{				
		switch (rpc_type) {			
			case RPC_REQUEST_SYNC: {
				TreeNode.ROOT.Synchronize(sender);
				break;
			}
				
			case RPC_NODE_SYNC: {	
				int tree_depth;
				if (!ctx.Read(tree_depth)) {
					break;
				}

				TreeNode current = TreeNode.ROOT;
				for (int i = 0; i < tree_depth; i++) {
					string uuid;
					ctx.Read(uuid);
					
					string type;
					ctx.Read(type);
					
					TreeNode node = current[uuid];
					if (!node) {
						node = TreeNode.Cast(type.ToType().Spawn());
						if (!node) {
							Error("Invalid node type " + type);
							continue;
						}
						
						current[uuid] = node;
						node.Parent = current[uuid];
					}
					
					current = current[uuid];
				}
								
				current.Read(ctx, 0);
				
				// Who do we sync back to?
				if (GetGame().IsDedicatedServer()) {
					array<PlayerIdentity> identities = {};
					GetGame().GetPlayerIndentities(identities);
					foreach (PlayerIdentity identity: identities) {
						
						// The client that sent the original RPC will not recieve it back - they are the most recent commit
						if (sender.GetId() != identity.GetId()) {
							current.Synchronize(identity);
						}
					}	
				} else {
					current.OnSynchronized();
				}
				
				break;
			}
		}
		
		super.OnRPC(sender, target, rpc_type, ctx);
	}
		
	ref array<ref Param3<string, vector, float>> DebugTexts = {};
	
	void DebugDrawText(string text, vector pos, float size)
	{
		DebugTexts.Insert(new Param3<string, vector, float>(text, pos, size));
	}
	
	// VERY handy when changing layouts :)
	void Recompile()
	{
		PlayerIdentity identity = GetPlayer().GetIdentity();
		delete TreeNode.ROOT[identity.GetPlainId()];
		
		EditorNode editor = new EditorNode(identity.GetPlainId(), identity.GetFullName(), Symbols.CAMERA.Regular());
		editor.Identity = identity;
		editor.Player = GetPlayer();
		TreeNode.ROOT[identity.GetPlainId()] = editor;
		
		editor.OnSynchronized();
	}
		
	static bool IsForbiddenItem(string model)
	{
		//! In theory should be safe but just in case
		if (model.Contains("Fx")) return true;
		if (model == "ItemOptics") return true;

		//! Cursed items
		if (model == "AKM_TESTBED") return true;
		if (model == "Red9") return true;
		if (model == "QuickieBow") return true;
		if (model == "LargeTentBackPack") return true;
		if (model == "SurvivorMale_Base" || model == "SurvivorFemale_Base") return true;
		if (model == "Land_VASICore" || model == "FlagCarrierCore") return true;
		if (GetGame().IsKindOf(model, "GP25Base")) return true;
		if (GetGame().IsKindOf(model, "M203Base")) return true;
		if (model == "ItemOptics_Base") return true;
		
		//! Everything is fine... I hope... :pain:
		return false;
	}
}